# Writing a Learning Log about Linux Network Architecture

## Context and Goal

Today, I worked on a real Linux network architecture with these goals:

- The LAN (POS network) must work without internet
- Only the server is allowed to access the internet (logs, updates)
- Strong isolation by design
- Ubuntu Linux
- Dual-NIC machines (server + PC)

This document summarizes all the notions and tools learned.

---

## 1. Network Interface (NIC)

A NIC (Network Interface Card) is a network port.

Each NIC appears in Linux with a name like:
- enp0s31f6 (Ethernet)
- enx00e04c5513b8 (USB Ethernet)
- wlp2s0 (Wi-Fi)

Command:
ip a

Used to:
- List interfaces
- See IP addresses
- Check if interfaces are UP or DOWN

---

## 2. IP Address and Subnet

An IP address identifies a device on a network.

Example:
192.168.0.101/24

Meaning:
- 192.168.0.101 → device address
- /24 → subnet mask (255.255.255.0)
- Network range: 192.168.0.0 – 192.168.0.255

Rule:
Devices in the same subnet communicate directly.

---

## 3. LAN vs WAN

LAN (Local Area Network):
- Internal network
- POS, server, cashier
- Private IPs
- Must work without internet

WAN (Wide Area Network):
- External network (ISP)
- Internet access
- Used only by the server

---

## 4. Routing

Routing decides where packets are sent.

Command:
ip route

Shows:
- Connected networks
- Gateways
- Default route

---

## 5. Default Route

The default route is the exit path for unknown destinations.

Example:
default via 192.168.128.1 dev enx00e04c5513b8

Meaning:
If the destination is not local, send traffic to this gateway.

Rule:
A machine should have only ONE default route.

---

## 6. Why LAN NIC Must Not Have a Gateway

If a LAN NIC has a gateway:
- Internet traffic may go through LAN
- Isolation is broken

Correct design:
- LAN NIC: no gateway
- ISP NIC: only default route

---

## 7. IP Forwarding

IP forwarding allows a machine to act as a router.

Check:
sysctl net.ipv4.ip_forward

Values:
- 0 = OFF (not a router)
- 1 = ON (router)

Rule:
Any dual-NIC machine must have IP forwarding OFF.

---

## 8. Making IP Forwarding Permanent

Create file:
/etc/sysctl.d/99-no-ip-forward.conf

Content:
net.ipv4.ip_forward = 0

Apply:
sudo sysctl --system

---

## 9. ARP / Neighbor Discovery

ARP maps IP addresses to MAC addresses on the LAN.

Command:
ip neigh

Used to:
- Check if a machine is alive on the LAN
- Diagnose connectivity issues

---

## 10. netplan (Server Configuration)

netplan manages persistent network configuration on Ubuntu servers.

Location:
/etc/netplan/*.yaml

Used to:
- Set static IP on LAN NIC
- Remove gateway from LAN NIC
- Keep DHCP on ISP NIC

Safe apply:
sudo netplan try

---

## 11. NetworkManager (PC Configuration)

Desktop Ubuntu uses NetworkManager.

Problem:
LAN DHCP added a default route.

Solution:
Mark LAN connection as never default.

Command:
sudo nmcli connection modify \"Wired connection 1\" ipv4.never-default yes

---

## 12. Diagnostic Commands Learned

- ip a
- ip route
- ip neigh
- ping
- sysctl
- nmcli
- netplan try

---

## Final Architecture Achieved

- POS LAN works without internet
- Server has exclusive internet access
- No routing between LAN and WAN
- Reboot-safe configuration
- Clean and secure design

---

## Key Rules Learned

- One default route per machine
- LAN NIC has no gateway
- Dual NIC = IP forwarding OFF
- Use netplan for servers
- Use NetworkManager rules for PCs


