# USB: Essential Guide + POS LAN Setup

Quick reference for understanding USB hardware and software.

---

## What is USB?

**USB (Universal Serial Bus)** = Communication protocol for connecting devices to computers
- **Physical**: Cables, connectors, electrical signals  
- **Logical**: Data format, communication rules

**Key Concept**: One USB controller chip creates multiple buses (Bus 001 = USB 2.0, Bus 002 = USB 3.0)

```bash
lspci | grep -i usb  # View your USB controller
```

---

## How It Works

### Connection Process (100-200ms)
1. Device plugged in → receives power
2. Device signals speed via D+ or D- voltage
3. Host sends RESET signal
4. Host requests device descriptor (Vendor ID, Product ID)
5. Host assigns device number (e.g., Device 005)
6. Host loads appropriate driver
7. Device ready

### Communication (Master-Slave)
- Host constantly polls devices every 10ms (keyboards/mice)
- Device responds with data or NAK (no data)
- Data sent in packets with error checking

---

## Device Enumeration Process

### Timeline: Plug to Ready
```
Timeline                Event
────────────────────────────────────────────────────────
0ms                     Plug in device
↓
0.1ms                   Device receives power
↓                       Capacitors charge, chips wake up
1ms                     Device pulls D+ or D- HIGH
↓                       (signals presence and speed)
10ms                    Host detects voltage change
↓                       USB controller interrupts CPU
20ms                    Host sends RESET signal
↓                       (10ms LOW pulse on D+ and D-)
30ms                    Speed negotiation complete
↓                       Device ready to communicate
40ms                    Host requests device descriptor
↓                       "Who are you?" (address 0)
50ms                    Device responds with basic info
↓                       Vendor ID, Product ID, Class
60ms                    Host assigns permanent address
↓                       "You are now Device 005"
80ms                    Host requests full descriptors
↓                       Configuration, interfaces, endpoints
100ms                   Kernel loads appropriate driver
↓                       Based on device class
150ms                   Device fully configured
↓                       Ready for normal operation
────────────────────────────────────────────────────────
Total: 100-200ms
```

### Step-by-Step Detail

#### Step 1: Physical Connection
```
You plug the USB connector into the port
         ↓
Device power circuit activates
         ↓
Device pulls voltage on D+ or D-
```
**Speed Detection:**
- **Low Speed (1.5 Mbps)**: D- pulled HIGH
- **Full Speed (12 Mbps)**: D+ pulled HIGH
- **High Speed (480 Mbps)**: D+ pulled HIGH, then chirp pattern

#### Step 2: Reset
```
Host: *Pulls D+ and D- LOW for 10ms*
Device: "Resetting myself..."
Host: *Releases lines*
Device: "Ready to talk!"
```
#### Step 3: Get Device Descriptor (First 8 Bytes)
```
Host → Device (address 0): SETUP packet
                           "Give me your descriptor"
```                       
## Device Identification

### Understanding lsusb
```
Bus 001 Device 005: ID 046d:c336 Logitech, Inc.
│       │           │    └─┬─┘  └─ Manufacturer
│       │           │      └─ Product ID
│       │           └─ Vendor ID
│       └─ Device number
└─ Bus number
```

**Common Vendor IDs**: 046d (Logitech), 8087 (Intel), 05ac (Apple), 18d1 (Google)

**Device Classes**: 03 (HID), 08 (Storage), 0E (Video), 07 (Printer), FF (Vendor Specific)

---

## USB Speeds & Bandwidth

| USB Version | Speed | Real-World | Port Color |
|-------------|-------|------------|------------|
| USB 2.0 | 480 Mbps | ~40 MB/s | Black/White |
| USB 3.0 | 5 Gbps | ~400 MB/s | Blue |
| USB 3.1 | 10 Gbps | ~900 MB/s | Teal |
| USB 3.2 | 20 Gbps | ~1.8 GB/s | Red |

**Bandwidth Sharing**: All devices on same bus share total bandwidth

```
Bus 001 (480 Mbps):
├── Keyboard: 0.1 Mbps
├── Mouse: 0.1 Mbps  
├── Flash drive: 30 Mbps
└── Available: ~450 Mbps
```

**Best Practice**: Spread high-bandwidth devices across different buses

---

## Drivers

**Built-in (works automatically)**: HID (`usbhid`), Storage (`usb-storage`), Video (`uvcvideo`), Audio (`snd-usb-audio`)

**Check loaded**: `lsmod | grep usb`

**Reload if needed**: `sudo modprobe -r usbhid && sudo modprobe usbhid`

---

## Essential Commands

```bash
lsusb                    # List all USB devices
lsusb -t                 # Show tree structure with speeds
lsusb -v                 # Verbose device info
sudo dmesg -w            # Monitor connections in real-time
lsblk                    # List storage devices
lspci | grep -i usb      # View USB controller
```

---

## Quick Troubleshooting

**Device not detected**: 
- Check `lsusb` (if not there → hardware issue)
- Try different port/cable

**Device detected but not working**:
- Check `lsmod | grep usb` (driver loaded?)
- Check `dmesg | grep -i usb | tail -20` (errors?)
- Reload driver

**Storage not mounting**:
- Check `lsblk` (device exists?)
- Mount manually: `sudo mount /dev/sdX1 /mnt/usb`

---

## Restaurant POS Application

**ThinkCentre M710q** (Cotonou, Benin):
- Bus 001 (USB 2.0): 4× tablets + keyboard + Bluetooth (~25 Mbps used / 480 Mbps)  
- Bus 002 (USB 3.0): Backup drive
- All 4 tablets work smoothly with <10% bandwidth usage

**Pre-deployment**: Test ports (`sudo dmesg -w`), verify controller (`lspci | grep -i usb`), label ports

---

## Understanding "Vendor" /ˈven.dər/

**Definition**: Person/company that sells something (Latin *vendere* = "to sell")

**In USB**: Vendor ID = Manufacturer code (046d=Logitech, 8087=Intel, 05ac=Apple)

**Usage**: Street vendor (*vendeur ambulant*), Business vendor (*fournisseur*), Tech vendor (*fabricant*)

**Word parts**: Vend (sell) + or (person who) = Vendor

---

*paul.craft() learning diary - 2026*