# Learning Log ‚Äî Cloudflare Pages & Workers (First Project)

**Date:** 2026-01-21  
**Topic:** Building a Markdown viewer with Cloudflare Pages, Functions, and Wrangler

---

## 1. Understanding Cloudflare's ecosystem

### Cloudflare Pages
- **Service**: Static site hosting (like Netlify, Vercel)
- **Purpose**: Host frontend files (HTML, CSS, JS)
- **Structure**: `public/` folder contains static assets
- **Automatic CDN**: Files distributed globally

### Cloudflare Functions (Workers in Pages)
- **What they are**: JavaScript code that runs on the edge (serverless)
- **Location**: `functions/` folder in the project
- **Routing**: File-based (e.g., `functions/api/render.js` ‚Üí `/api/render`)
- **Use case**: Backend logic, API endpoints, dynamic content generation

### Cloudflare Workers (standalone)
- **Difference**: Workers = standalone serverless functions
- **Functions vs Workers**: Functions are Workers integrated into Pages
- **Same technology**: Both run on Cloudflare's edge network

**Key insight**: Cloudflare Pages + Functions = frontend + backend in one project, similar to FastAPI + React but serverless.

---

## 2. Wrangler CLI

### What is Wrangler?
- **Official CLI** for Cloudflare services
- **Like**: `flask run` for Flask, `git` for GitHub, `npm` for Node
- **Production-ready**: Used by Discord, Shopify, thousands of companies

### Key commands learned
```bash
# Login (OAuth, one-time)
wrangler login

# Check who you are
wrangler whoami

# Local development
wrangler pages dev public

# Deploy to production
wrangler pages deploy public

# Manage secrets (encrypted storage)
wrangler secret put SECRET_NAME
```

### Authentication
- **Login once**: Token stored locally in `~/.wrangler/config/`
- **Persistent**: Survives reboots, works across projects
- **When to re-login**: New machine, token revoked, or expired

---

## 3. Project structure

### The md-viewer project
```
md-viewer/                    # Local repo
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ index.html           # Frontend (file list)
‚îú‚îÄ‚îÄ functions/
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ render.js        # Backend Worker (Markdown converter)
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ node_modules/
‚îÇ   ‚îî‚îÄ‚îÄ marked/              # Markdown parser
‚îî‚îÄ‚îÄ wrangler.toml            # Config (optional)
```

### Two separate repos
1. **learning-log** (GitHub): Contains `.md` files
   - Must be **public** for raw access
   - URL format: `https://raw.githubusercontent.com/USER/REPO/main/file.md`

2. **md-viewer** (local + deployed): The viewer application
   - Reads files from the other repo
   - Converts Markdown ‚Üí HTML
   - Deploys to Cloudflare Pages

---

## 4. How the viewer works

### Flow
```
User visits https://learning-log.pages.dev
    ‚Üì
Cloudflare serves public/index.html (file list)
    ‚Üì
User clicks on "2026-01-16.md"
    ‚Üì
Request: /api/render?file=2026/2026-01-16.md
    ‚Üì
Worker (functions/api/render.js) executes:
  1. Fetches https://raw.githubusercontent.com/.../2026-01-16.md
  2. Converts Markdown ‚Üí HTML (using marked library)
  3. Wraps in styled HTML template (Tailwind)
  4. Returns complete page
    ‚Üì
User sees beautifully formatted document
```

### Backend code anatomy
```javascript
export async function onRequestGet(context) {
  // 1. Extract file parameter
  const file = url.searchParams.get('file');
  
  // 2. Fetch from GitHub
  const response = await fetch(githubUrl);
  const markdown = await response.text();
  
  // 3. Convert to HTML
  const html = marked.parse(markdown);
  
  // 4. Return styled page
  return new Response(`<html>...</html>`);
}
```

**Key concepts**:
- `export async function onRequestGet()` = handles GET requests
- `context.request` = incoming HTTP request
- `fetch()` = make HTTP requests (like `requests.get()` in Python)
- `Response()` = return HTTP response (HTML, JSON, etc.)

---

## 5. Tailwind CSS integration

### Via CDN (simplest approach)
```html
<script src="https://cdn.tailwindcss.com?plugins=typography"></script>
```

**Critical discovery**: The `?plugins=typography` parameter loads the Typography plugin from CDN!

### Tailwind Typography (`prose`)
- **Purpose**: Automatic styling for Markdown/HTML content
- **Classes used**:
  - `prose` = base typography styles
  - `prose-lg` = larger text
  - `prose-orange` = orange accent color
  - `max-w-none` = remove max-width constraint

### Why not CSS?
- Tailwind = utility-first, responsive by default
- `prose` classes = 100+ lines of CSS done automatically
- Consistent with modern web development practices
- Useful for future projects (like POS system)

---

## 6. Deployment workflow

### Local development
```bash
wrangler pages dev public
# Server runs on http://localhost:8788
# Hot reload for most changes
# Restart for Functions changes
```

### Production deployment
```bash
wrangler pages deploy public --compatibility-date=2025-01-21
```

**What happens**:
1. Wrangler uploads `public/` folder
2. Wrangler compiles and uploads `functions/`
3. Cloudflare generates URL: `https://[hash].learning-log.pages.dev`
4. Site is live globally in seconds

### Future: Git auto-deploy
- Connect GitHub repo on Cloudflare Dashboard
- Every `git push` ‚Üí automatic deployment
- No need for `wrangler pages deploy`
- But Wrangler CLI gives more control

---

## 7. Security lessons (R2 tokens incident)

### What happened
- Accidentally pushed `.env` with R2 credentials to GitHub
- Even after deleting, credentials remain in Git history
- GitHub is not truly "private" for secrets

### Proper secret management
```bash
# ‚ùå NEVER do this
# .env (committed to Git)
R2_ACCESS_KEY=abc123

# ‚úÖ Always do this
wrangler secret put R2_ACCESS_KEY
# Stored encrypted on Cloudflare, never in code
```

### Token rotation procedure
1. Create NEW token (don't revoke old one yet)
2. Update application with new token
3. Test that everything works
4. THEN revoke old token
5. **Zero downtime**

### `.gitignore` essentials
```
.env
.env.*
!.env.example
.wrangler/
.dev.vars
*credentials*
*secrets*
```

---

## 8. Cloudflare API tokens types

### Account API Tokens
- **Scope**: Tied to Cloudflare account
- **Duration**: Remain active even if you leave an organization
- **Use case**: Production services, long-term projects
- **Example**: R2 storage for production apps

### User API Tokens
- **Scope**: Tied to user account
- **Duration**: Become inactive if you leave organization
- **Use case**: Personal development, CI/CD
- **Example**: Build tokens for personal projects

### Best practices
- Name tokens with dates: `r2-token-2025-01-21`
- Set expiration when possible (1 year)
- Review and revoke unused tokens regularly
- Use least privilege (only necessary permissions)

---

## 9. Technical concepts clarified

### Workers vs Functions
- **Workers**: Standalone serverless functions
- **Functions**: Workers integrated into Pages projects
- **Same technology**, different deployment contexts

### Backend returns anything
A Worker can return:
- HTML (like our viewer)
- JSON (REST API)
- Images, PDFs, CSV
- Redirects
- Any HTTP response

**It's not always HTML!** Workers = flexible backend.

### File locations matter
- `/mnt/user-data/uploads/` = user-uploaded files (read-only in computer use)
- `/home/claude/` = Claude's working directory
- `/mnt/user-data/outputs/` = files to share with user

---

## 10. Real-world connections to POS project

### Cloudflare for African restaurants POS

**Potential architecture**:
```
Restaurant (Cotonou) - Offline First
‚îú‚îÄ‚îÄ Local server (PostgreSQL + FastAPI)
‚îî‚îÄ‚îÄ Sync to cloud ‚ÜïÔ∏è

Cloudflare (Backend)
‚îú‚îÄ‚îÄ Workers: Sync API, validation, user management
‚îú‚îÄ‚îÄ R2: Product images, backups, reports
‚îú‚îÄ‚îÄ D1: Shared product catalog, multi-restaurant config
‚îî‚îÄ‚îÄ Pages: Admin dashboard
```

**Advantages for Africa**:
- Edge network with servers in South Africa (closer than AWS eu-west)
- Zero egress fees (R2 vs S3)
- Predictable pricing
- Offline-first friendly (sync when network available)

**Wrangler for POS**:
```bash
wrangler deploy --env cotonou    # Deploy Cotonou-specific config
wrangler tail --env production   # Real-time logs
wrangler secret put API_KEY      # Secure credential management
```

---

## 11. Concepts to explore later

### For md-viewer improvements
- **Search functionality**: Full-text search across notes
- **Tags/categories**: Organize notes by topic
- **Dark mode**: User preference toggle
- **Table of contents**: Auto-generated from headings
- **GitHub API**: Automatically list all `.md` files (no manual list)

### For deeper Cloudflare knowledge
- **Durable Objects**: Stateful Workers (for real-time features)
- **KV Storage**: Key-value store for fast reads
- **D1 Database**: SQLite at the edge
- **Queue**: Asynchronous task processing
- **Email Workers**: Send/receive emails programmatically

### For POS project
- **Authentication**: User login with Workers
- **Rate limiting**: Protect APIs from abuse
- **Caching strategies**: Optimize performance
- **Multi-environment**: dev, staging, production
- **CI/CD**: Automated testing and deployment

---

## 12. Commands reference

### Wrangler
```bash
wrangler login                          # Authenticate
wrangler whoami                         # Check current user
wrangler pages dev public               # Local development
wrangler pages deploy public            # Deploy to production
wrangler secret put SECRET_NAME         # Add encrypted secret
wrangler tail                           # Real-time logs
wrangler pages deployments list         # View deployment history
```

### Project setup
```bash
npm init -y                             # Initialize package.json
npm install marked                      # Install Markdown parser
npm install -g wrangler                 # Install Wrangler globally
```

### Git (for future auto-deploy)
```bash
git init
git add .
git commit -m "initial commit"
git remote add origin https://github.com/USER/REPO.git
git push -u origin main
```

---

## 13. Key takeaways

### Technical skills acquired
‚úÖ Cloudflare Pages + Functions architecture  
‚úÖ Wrangler CLI (professional tool)  
‚úÖ Serverless backend concepts  
‚úÖ JavaScript Workers (similar to FastAPI but JS)  
‚úÖ Tailwind CSS with Typography plugin  
‚úÖ Secure secret management  
‚úÖ GitHub raw file access  

### Mindset shifts
- **Serverless thinking**: No servers to manage, code runs on-demand
- **Edge computing**: Code runs close to users globally
- **Separation of concerns**: Frontend (static) vs Backend (dynamic)
- **Security first**: Never commit secrets, use encrypted storage

### Comparison to existing knowledge
| Concept | Python/FastAPI equivalent | Cloudflare equivalent |
|---------|---------------------------|----------------------|
| Backend framework | FastAPI | Workers/Functions |
| Local dev server | `uvicorn main:app` | `wrangler pages dev` |
| Deploy command | Manual server setup | `wrangler pages deploy` |
| Environment variables | `.env` file | `wrangler secret put` |
| Static files | `/static` folder | `public/` folder |

---

## 14. Project outcome

### What was built
- **URL**: https://9384f4b2.learning-log.pages.dev
- **Functionality**: Markdown file viewer
- **Source**: Reads from `FranssenPaul/learning-log` GitHub repo
- **Styling**: Tailwind CSS with Typography
- **Deployment**: Live on Cloudflare's global network

### Files created
```
md-viewer/
‚îú‚îÄ‚îÄ public/index.html        (68 lines) - File list UI
‚îú‚îÄ‚îÄ functions/api/render.js  (87 lines) - Markdown converter Worker
‚îú‚îÄ‚îÄ package.json             (12 lines) - Dependencies
‚îî‚îÄ‚îÄ wrangler.toml            (3 lines)  - Configuration
```

**Total code**: ~170 lines for a fully functional, globally deployed app! üöÄ

---

## 15. Next steps

### Immediate improvements
- [ ] Add dark mode toggle
- [ ] Implement search functionality
- [ ] Auto-generate file list from GitHub API
- [ ] Add navigation between files (previous/next)

### Learning path
- [ ] Explore Cloudflare D1 (SQLite database)
- [ ] Build a simple API with Workers
- [ ] Integrate R2 storage (for images, files)
- [ ] Set up GitHub auto-deploy

### POS project integration
- [ ] Design sync API with Workers
- [ ] Plan R2 usage for product images
- [ ] Consider D1 for shared product catalog
- [ ] Prototype admin dashboard with Pages

---

## Reflection

**What worked well**:
- Wrangler CLI is intuitive and powerful
- Cloudflare's free tier is very generous
- Tailwind + Typography makes styling trivial
- Deployment is instant (seconds, not minutes)

**What was challenging**:
- Understanding the difference between Workers, Functions, and Pages
- Private GitHub repos require authentication (switched to public)
- Tailwind Typography not in base CDN (needed `?plugins=typography`)
- Compatibility date must be present/past, not future

**Most valuable lesson**: Serverless architecture simplifies deployment and scaling. No servers to manage, instant global distribution, and usage-based pricing. Perfect for side projects and startups.

---

**End of log** ‚Äî Project successfully deployed! üéâ